<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Service Eligibility | Redemption Law Group</title>
  <style>
    /* (same as your existing styles) */
    html,body{margin:0;padding:0;font-family:Arial,sans-serif;background:#f8f9fa;color:#212529;}
    #form-container{max-width:600px;margin:40px auto;padding:20px;background:#fff;border:1px solid #ccc;border-radius:8px;}
    h1,h2,p,label{margin:0 0 12px;}
    .step{display:none;}
    .step.active{display:block;}
    input,select{width:100%;padding:10px;margin-bottom:16px;border:1px solid #ccc;border-radius:4px;box-sizing:border-box;}
    .radio-group,label.checkbox-group{margin-bottom:16px;}
    .radio-group label, .checkbox-group label{display:inline-block;margin-right:20px;cursor:pointer;}
    .btn{padding:10px 20px;margin:5px;border:none;border-radius:4px;cursor:pointer;}
    .btn-primary{background:#0d6efd;color:#fff;}
    .btn-secondary{background:#6c757d;color:#fff;}
    .hidden{display:none;}
    .error-msg{color:#d9534f;font-size:0.9em;display:none;margin-top:-12px;margin-bottom:12px;}
    .note, .ineligible-msg{font-size:0.9em;color:#555;margin-top:-12px;margin-bottom:12px;display:none;}
  </style>
</head>
<body>
  <div id="form-container">
    <h1 id="form-title">Service Eligibility Form</h1>
    <form id="eligibility-form" novalidate>
      <!-- STEP 1: Contact Info -->
      <div id="step-1" class="step active">
        <h2>Step 1: Contact Information</h2>
        <label for="firstName">First Name</label>
        <input type="text" id="firstName" name="firstName" required autocomplete="given-name">
        <label for="lastName">Last Name</label>
        <input type="text" id="lastName" name="lastName" required autocomplete="family-name">
        <span class="error-msg">Please enter both first and last name.</span>

        <label for="phone">Phone Number</label>
        <input type="tel" id="phone" name="phone" required autocomplete="tel">
        <span class="error-msg">Please enter your phone number.</span>

        <label for="email">Email Address</label>
        <input type="email" id="email" name="email" required autocomplete="email">
        <span class="error-msg">Please enter a valid email address.</span>

        <label for="street">Street Address</label>
        <input type="text" id="street" name="street" required autocomplete="street-address">
        <label for="city">City</label>
        <input type="text" id="city" name="city" required autocomplete="address-level2">
        <label for="state">State</label>
        <input type="text" id="state" name="state" required autocomplete="address-level1">
        <label for="zip">ZIP Code</label>
        <input type="text" id="zip" name="zip" required autocomplete="postal-code">
        <span class="error-msg">Complete your mailing address.</span>

        <label>Are you currently based in California?</label>
        <div class="radio-group">
          <label><input type="radio" name="basedCA" value="yes" required> Yes</label>
          <label><input type="radio" name="basedCA" value="no" required> No</label>
        </div>
        <span class="error-msg">Please select Yes or No.</span>
      </div>

      <!-- STEP 2: Service Options -->
      <div id="step-2" class="step">
        <h2>Step 2: What service are you interested in, <span id="greetingName"></span>?</h2>
        <div class="radio-group">
          <label><input type="radio" name="service" value="expungement" required> Criminal Record Expungement</label><br>
          <label><input type="radio" name="service" value="cor"> Certificate of Rehabilitation</label><br>
          <label><input type="radio" name="service" value="sealing"> Arrest Record Sealing</label><br>
          <label><input type="radio" name="service" value="termination"> Early Probation Termination</label>
        </div>
        <span class="error-msg">Please select one service.</span>
      </div>

      <!-- STEP 3: Expungement Questions -->
      <div id="step-3-1" class="step">
        <h2>Expungement: Court Type</h2>
        <label>What type of court were you convicted in?</label>
        <div class="radio-group">
          <label><input type="radio" name="expCourt" value="state" required> State</label>
          <label><input type="radio" name="expCourt" value="federal"> Federal</label>
        </div>
        <span class="note">We only handle CA state cases.</span>
        <span class="ineligible-msg">You’re not eligible for Expungement. <button type="button" class="btn btn-primary" id="toCOR1">Proceed</button></span>
        <span class="error-msg">Select State or Federal.</span>
      </div>

      <div id="step-3-2" class="step">
        <h2>Expungement: County</h2>
        <label>Which county?</label>
        <select name="expCounty" required>
          <option value="" disabled selected>Select a county</option>
          <option>Alameda</option><!-- etc. -->
          <option>Yuba</option>
        </select>
        <span class="error-msg">Please select a county.</span>
      </div>

      <div id="step-3-3" class="step">
        <h2>Expungement: Conviction Type</h2>
        <label>You were convicted of a:</label>
        <div class="radio-group">
          <label><input type="radio" name="expType" value="felony" required> Felony</label>
          <label><input type="radio" name="expType" value="misdemeanor"> Misdemeanor</label>
        </div>
        <span class="error-msg">Choose Felony or Misdemeanor.</span>
      </div>

      <div id="step-3-4" class="step">
        <h2>Expungement: State Prison</h2>
        <label>Did you serve time in State Prison?</label>
        <div class="radio-group">
          <label><input type="radio" name="expPrison" value="no" required> No</label>
          <label><input type="radio" name="expPrison" value="yes"> Yes</label>
        </div>
        <span class="ineligible-msg">You’re not eligible. <button type="button" class="btn btn-primary" id="toCOR2">Proceed</button></span>
        <span class="error-msg">Please select Yes or No.</span>
      </div>

      <div id="step-3-5" class="step">
        <h2>Expungement: Probation</h2>
        <label>Have you completed probation?</label>
        <div class="radio-group">
          <label><input type="radio" name="expProb" value="yes" required> Yes</label>
          <label><input type="radio" name="expProb" value="no"> No</label>
        </div>
        <span class="note">You may be eligible for Early Probation Termination. <button type="button" class="btn btn-primary" id="toTerm">Proceed</button></span>
        <span class="error-msg">Please select Yes or No.</span>
      </div>

      <div id="step-3-6" class="step">
        <h2>Expungement: Restitution</h2>
        <label>Have you paid restitution in full?</label>
        <div class="radio-group">
          <label><input type="radio" name="expRest" value="yes" required> Yes</label>
          <label><input type="radio" name="expRest" value="no"> No</label>
        </div>
        <span class="ineligible-msg">Unfortunately, you need to pay your restitution in full before seeking an expungement. Please try again after restitution has been paid.</span>
        <span class="error-msg">Please select Yes or No.</span>
      </div>

      <!-- FINAL STEP -->
      <div id="step-final" class="step">
        <h2 id="final-title"></h2>
        <p id="final-desc"></p>
        <label class="checkbox-group">
          <input type="checkbox" id="agree" required>
          I agree to the <a href="/terms">Terms of Service</a>, <a href="/privacy">Privacy Statement</a>, and <a href="/refund">Refund Policy</a>.
        </label>
        <span class="error-msg">You must agree before proceeding.</span>
        <button type="button" class="btn btn-primary" id="payBtn" disabled>Proceed to payment</button>
      </div>

      <!-- NAVIGATION -->
      <div style="text-align:right;">
        <button type="button" class="btn btn-secondary hidden" id="prevBtn">Back</button>
        <button type="button" class="btn btn-primary" id="nextBtn">Next</button>
      </div>
    </form>
  </div>

  <script>
  (function(){
    const form = document.getElementById('eligibility-form'),
          steps = [...document.querySelectorAll('.step')],
          prevBtn = document.getElementById('prevBtn'),
          nextBtn = document.getElementById('nextBtn'),
          payBtn = document.getElementById('payBtn'),
          agree  = document.getElementById('agree'),
          greeting = document.getElementById('greetingName'),
          finalTitle = document.getElementById('final-title'),
          finalDesc  = document.getElementById('final-desc');

    const stripeLinks = {
      expungement: 'https://buy.stripe.com/expungement',
      cor:         'https://buy.stripe.com/certificate',
      sealing:     'https://buy.stripe.com/sealing',
      termination: 'https://buy.stripe.com/termination'
    };

    let seq = [], idx = 0;

    function buildSeq(){
      const svc = form.service.value;
      const base = ['step-1','step-2'];
      if(svc==='expungement'){
        base.push('step-3-1','step-3-2','step-3-3','step-3-4','step-3-5','step-3-6');
      }
      base.push('step-final');
      return base;
    }

    function show(i){
      steps.forEach(s=>s.classList.remove('active'));
      document.getElementById(seq[i]).classList.add('active');
      prevBtn.classList.toggle('hidden', i===0);
      nextBtn.classList.toggle('hidden', seq[i]==='step-final');
    }

    function validateCurrent(){
      const container = document.getElementById(seq[idx]);
      let valid = true;
      container.querySelectorAll('input[required],select[required]').forEach(el=>{
        if(el.type==='radio'){
          const group = container.querySelectorAll(`input[name="${el.name}"]`);
          if(![...group].some(r=>r.checked)) valid=false;
        } else if(!el.value.trim()){
          valid=false;
        }
      });
      container.querySelector('.error-msg').style.display = valid? 'none':'block';
      return valid;
    }

    function jumpToService(key){
      form.service.value = key;
      seq = buildSeq();
      idx = seq.indexOf('step-2');
      show(idx);
    }

    // “Proceed” buttons in ineligible messages:
    document.getElementById('toCOR1').onclick = ()=> jumpToService('cor');
    document.getElementById('toCOR2').onclick = ()=> jumpToService('cor');
    document.getElementById('toTerm').onclick = ()=> jumpToService('termination');

    nextBtn.onclick = ()=>{
      if(!validateCurrent()) return;

      // special ineligible cases in Expungement steps:
      const stepId = seq[idx];
      const vals = form;
      if(stepId==='step-3-1' && vals.expCourt.value==='federal'){
        toggleMsg('step-3-1','ineligible-msg',true); return;
      }
      if(stepId==='step-3-4' && vals.expPrison.value==='yes'){
        toggleMsg('step-3-4','ineligible-msg',true); return;
      }
      if(stepId==='step-3-5' && vals.expProb.value==='no'){
        toggleMsg('step-3-5','note',true); return;
      }
      if(stepId==='step-3-6' && vals.expRest.value==='no'){
        toggleMsg('step-3-6','ineligible-msg',true); return;
      }

      idx++;
      if(seq[idx]==='step-final'){
        const svc = form.service.value;
        const n = form.firstName.value || '';
        greeting.textContent = n;
        finalTitle.textContent = `Great, ${n}! You’ve chosen ${svc.charAt(0).toUpperCase()+svc.slice(1)}.`;
        finalDesc.textContent = ({
          expungement: 'Clear your eligible conviction from your California record.',
          cor:         'Obtain a Certificate of Rehabilitation to restore your rights.',
          sealing:     'Seal your arrest record from public view.',
          termination: 'End your probation early and reclaim your freedom.'
        })[svc];
      }
      show(idx);
    };

    prevBtn.onclick = ()=>{
      if(idx>0){ idx--; show(idx); }
    };

    agree.onchange = ()=> payBtn.disabled = !agree.checked;
    payBtn.onclick = ()=> window.location.href = stripeLinks[form.service.value];

    // on service selection, rebuild seq so Next knows where to go
    form.step-2?.addEventListener('change', ()=>{
      seq = buildSeq();
    });
  })();

  // helper to toggle notes/ineligible
  function toggleMsg(stepId, cls, show){
    const elm = document.querySelector(`#${stepId} .${cls}`);
    elm.style.display = show? 'block':'none';
    document.getElementById('prevBtn').classList.add('hidden');
    document.getElementById('nextBtn').classList.add('hidden');
  }
  </script>
</body>
</html>
