<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Service Eligibility Form | Redemption Law Group</title>
  <style>
    /* Reset and base styles */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      font-family: Arial, sans-serif;
      background-color: #f8f9fa;
      color: #212529;
    }
    /* Full-page container */
    #form-container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
      padding: 20px;
    }
    form {
      background: #fff;
      border: 1px solid #ced4da;
      border-radius: 5px;
      max-width: 500px;
      width: 100%;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 {
      margin-top: 0;
      font-size: 1.2em;
      color: #212529;
    }
    /* Step sections */
    .step {
      margin-bottom: 20px;
    }
    .step.active {
      display: block;
    }
    /* Input styles */
    input[type=text], input[type=email], input[type=tel] {
      width: 100%;
      padding: 8px;
      margin: 5px 0 10px;
      box-sizing: border-box;
      border: 1px solid #ced4da;
      border-radius: 4px;
      font-size: 1em;
    }
    input[type=text]:focus, input[type=email]:focus, input[type=tel]:focus {
      outline: none;
      border-color: #0d6efd;
      box-shadow: 0 0 0 4px rgba(13, 110, 253, 0.1);
    }
    /* Checkbox and radio styles */
    input[type=checkbox], input[type=radio] {
      accent-color: #0d6efd;
    }
    .service-option { display: none; }
    .service-label {
      display: block;
      padding: 10px;
      margin-bottom: 10px;
      border: 2px solid #ced4da;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 500;
      position: relative;
    }
    .service-label:hover { border-color: #0d6efd; }
    .service-label::before {
      content: "";
      display: inline-block;
      width: 20px;
      height: 20px;
      margin-right: 10px;
      border: 2px solid #0d6efd;
      border-radius: 4px;
      vertical-align: middle;
      background-color: #fff;
      background-image: none;
      background-position: center;
      background-repeat: no-repeat;
      transition: background-color 0.2s, background-image 0.2s;
    }
    .service-option:checked + .service-label::before {
      background-color: #0d6efd;
      background-image: url("data:image/svg+xml,%3Csvg width='14' height='12' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23fff' d='M4.8 9.6L1.2 6l-1 1 4.6 4.6L14 2.4l-1-1z'/%3E%3C/svg%3E");
    }
    .service-option:checked + .service-label {
      border-color: #0d6efd;
      background: #e7f1ff;
    }
    .radio-group label {
      margin-right: 20px;
      cursor: pointer;
    }
    .radio-group label:last-child { margin-right: 0; }
    /* Notes and error messages */
    .note {
      font-size: 0.9em;
      color: #6c757d;
      margin: 5px 0 0 0;
    }
    .eligibility-note {
      font-weight: 500;
      margin: 10px 0;
    }
    .eligibility-note.success { color: #28a745; }
    .eligibility-note.warning { color: #d9534f; }
    .error-msg {
      color: #d9534f;
      font-weight: 500;
      margin-top: 5px;
      display: none;
    }
    /* Navigation buttons */
    #navigation {
      text-align: right;
      margin-top: 15px;
    }
    .btn {
      display: inline-block;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      text-decoration: none;
      text-align: center;
      box-sizing: border-box;
    }
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .btn-primary {
      background-color: #0d6efd;
      color: #fff;
    }
    .btn-primary:hover { background-color: #0b5ed7; }
    .btn-secondary {
      background-color: #6c757d;
      color: #fff;
    }
    .btn-secondary:hover { background-color: #5c636a; }
    /* Final recommendations styling */
    .recommendation {
      border: 1px solid #ced4da;
      border-radius: 5px;
      padding: 15px;
      margin-bottom: 15px;
      background: #f8f9fa;
    }
    .recommendation h3 { margin-top: 0; }
    .recommendation ul {
      margin: 0;
      padding-left: 20px;
    }
    .recommendation ul li { margin-bottom: 5px; }
    .recommendation p { margin-bottom: 10px; }
    .recommendation .btn {
      margin-top: 10px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div id="form-container">
    <form id="eligibility-form">
      <!-- Step 1: Name -->
      <div id="step-name" class="step active">
        <p><strong>What's your name?</strong></p>
        <input type="text" name="name" id="name" placeholder="Your Name" required />
        <p class="error-msg">Please enter your name.</p>
      </div>
      <!-- Step 2: Email -->
      <div id="step-email" class="step" style="display:none;">
        <p id="email-question"><strong>Nice to meet you, <span id="userNameSpan"></span>! What's your email address?</strong></p>
        <input type="email" name="email" id="email" placeholder="you@example.com" required />
        <p class="error-msg">Please enter a valid email.</p>
      </div>
      <!-- Step 3: Phone -->
      <div id="step-phone" class="step" style="display:none;">
        <p><strong>Finally, what is your phone number?</strong></p>
        <input type="tel" name="phone" id="phone" placeholder="e.g. 555-123-4567" required />
        <p class="error-msg">Please enter your phone number.</p>
      </div>
      <!-- Step 4: Service Selection -->
      <div id="step-service" class="step" style="display:none;">
        <p><strong>Which service are you interested in? <br><small>(Select one)</small></strong></p>
        <div>
          <input type="radio" id="service-expungement" class="service-option" name="services" value="expungement" />
          <label for="service-expungement" class="service-label">Record Expungement ($990)</label>
        </div>
        <div>
          <input type="radio" id="service-cor" class="service-option" name="services" value="cor" />
          <label for="service-cor" class="service-label">Certificate of Rehabilitation ($1,295)</label>
        </div>
        <div>
          <input type="radio" id="service-sealing" class="service-option" name="services" value="sealing" />
          <label for="service-sealing" class="service-label">Arrest Record Sealing ($1,695)</label>
        </div>
        <div>
          <input type="radio" id="service-termination" class="service-option" name="services" value="termination" />
          <label for="service-termination" class="service-label">Early Probation Termination ($1,695)</label>
        </div>
        <p id="serviceError" class="error-msg">Please select a service.</p>
      </div>
      <!-- Record Expungement Questions -->
      <div id="step-exp-q1" class="step" style="display:none;">
        <p><strong>Let's see if you qualify for a Record Expungement.</strong><br>Which court handled the conviction you want expunged?</p>
        <div class="radio-group">
          <label><input type="radio" name="exp_court" value="state" required /> State Court (California state)</label>
          <label><input type="radio" name="exp_court" value="federal" required /> Federal Court</label>
        </div>
        <p class="note exp_court_state" style="display:none;">Expungements in California are only available for state convictions.</p>
        <p class="note exp_court_federal" style="display:none;">Federal convictions cannot be expunged under California law.</p>
        <p class="error-msg">Please answer this question.</p>
      </div>
      <div id="step-exp-q2" class="step" style="display:none;">
        <p><strong>Have you completed probation?</strong></p>
        <div class="radio-group">
          <label><input type="radio" name="exp_probation" value="yes" required /> Yes</label>
          <label><input type="radio" name="exp_probation" value="no" required /> No</label>
        </div>
        <p class="note exp_probation_yes" style="display:none;">Great! You've completed probation, which is required for expungement eligibility.</p>
        <p class="note exp_probation_no" style="display:none;">You'll typically need to finish or terminate probation early before you can get an expungement.</p>
        <p class="error-msg">Please answer this question.</p>
      </div>
      <div id="step-exp-q3" class="step" style="display:none;">
        <p><strong>Were you required to pay restitution as part of your sentence?</strong></p>
        <div class="radio-group">
          <label><input type="radio" name="exp_restitution_required" value="yes" required /> Yes</label>
          <label><input type="radio" name="exp_restitution_required" value="no" required /> No</label>
        </div>
        <p class="note exp_restitution_required_yes" style="display:none;">If restitution was ordered, it must be paid off to qualify for expungement.</p>
        <p class="note exp_restitution_required_no" style="display:none;">No restitution requirement makes the process a bit easier.</p>
        <p class="error-msg">Please answer this question.</p>
      </div>
      <div id="step-exp-q4" class="step" style="display:none;">
        <p><strong>Have you paid all the required restitution?</strong></p>
        <div class="radio-group">
          <label><input type="radio" name="exp_restitution_paid" value="yes" required /> Yes</label>
          <label><input type="radio" name="exp_restitution_paid" value="no" required /> No</label>
        </div>
        <p class="note exp_restitution_paid_yes" style="display:none;">Great. Paying restitution in full is necessary for expungement eligibility.</p>
        <p class="note exp_restitution_paid_no" style="display:none;">Unfortunately, you are not eligible for expungement until restitution is paid. You may still qualify for a Certificate of Rehabilitation. <button type="button" id="toCorBtn" class="btn btn-secondary btn-sm">Find Out More</button></p>
        <p class="error-msg">Please answer this question.</p>
      </div>
      <div id="step-exp-q5" class="step" style="display:none;">
        <p><strong>Do you have any new charges or convictions since that conviction?</strong></p>
        <div class="radio-group">
          <label><input type="radio" name="exp_new_offense" value="no" required /> No, no new charges</label>
          <label><input type="radio" name="exp_new_offense" value="yes" required /> Yes, I have new charges/convictions</label>
        </div>
        <p class="note exp_new_offense_yes" style="display:none;">Having pending charges or recent convictions will prevent an expungement until those are resolved.</p>
        <p class="note exp_new_offense_no" style="display:none;">Excellent. Staying crime-free since your conviction helps your expungement case.</p>
        <p class="error-msg">Please answer this question.</p>
      </div>
      <div id="step-exp-q6" class="step" style="display:none;">
        <p><strong>Did you serve any time in state prison for that conviction?</strong></p>
        <div class="radio-group">
          <label><input type="radio" name="exp_prison" value="no" required /> No</label>
          <label><input type="radio" name="exp_prison" value="yes" required /> Yes</label>
        </div>
        <p class="note exp_prison_yes" style="display:none;">Cases with state prison sentences aren't eligible for a standard expungement. A Certificate of Rehabilitation will be recommended instead.</p>
        <p class="note exp_prison_no" style="display:none;">Great. Convictions not involving state prison are usually eligible for expungement.</p>
        <p class="error-msg">Please answer this question.</p>
      </div>
      <!-- Certificate of Rehabilitation Questions -->
      <div id="step-cor-q1" class="step" style="display:none;">
        <p><strong>Now let's check your eligibility for a Certificate of Rehabilitation.</strong><br>Have you completed all your sentences, including any probation or parole?</p>
        <div class="radio-group">
          <label><input type="radio" name="cor_completed" value="yes" required /> Yes</label>
          <label><input type="radio" name="cor_completed" value="no" required /> No</label>
        </div>
        <p class="note cor_completed_yes" style="display:none;">Good. You must finish all sentencing (probation, parole) to be eligible for a Certificate of Rehabilitation.</p>
        <p class="note cor_completed_no" style="display:none;">You'll need to complete your sentence (or wait until you're off probation/parole) before applying for a Certificate of Rehabilitation.</p>
        <p class="error-msg">Please answer this question.</p>
      </div>
      <div id="step-cor-q2" class="step" style="display:none;">
        <p><strong>Has it been several years since your last conviction or release?</strong><br><small>(Typically, a sustained period of rehabilitation is required)</small></p>
        <div class="radio-group">
          <label><input type="radio" name="cor_years" value="yes" required /> Yes, it's been a few years</label>
          <label><input type="radio" name="cor_years" value="no" required /> No, it hasn't been that long</label>
        </div>
        <p class="note cor_years_yes" style="display:none;">Great. A sustained period with no new offenses is required for a Certificate of Rehabilitation.</p>
        <p class="note cor_years_no" style="display:none;">A longer period of staying crime-free is typically required to qualify for a Certificate of Rehabilitation.</p>
        <p class="error-msg">Please answer this question.</p>
      </div>
      <div id="step-cor-q3" class="step" style="display:none;">
        <p><strong>Are you currently a California resident?</strong></p>
        <div class="radio-group">
          <label><input type="radio" name="cor_resident" value="yes" required /> Yes</label>
          <label><input type="radio" name="cor_resident" value="no" required /> No</label>
        </div>
        <p class="note cor_resident_yes" style="display:none;">Good. You generally need to reside in California to petition for a Certificate of Rehabilitation here.</p>
        <p class="note cor_resident_no" style="display:none;">You'll usually need to be a California resident to apply for a Certificate of Rehabilitation in California.</p>
        <p class="error-msg">Please answer this question.</p>
      </div>
      <!-- Arrest Record Sealing Questions -->
      <div id="step-sealing-q1" class="step" style="display:none;">
        <p><strong>Let's see about sealing your arrest record.</strong><br>Were you ever convicted of a crime from this arrest?</p>
        <div class="radio-group">
          <label><input type="radio" name="seal_conviction" value="no" required /> No, I was not convicted</label>
          <label><input type="radio" name="seal_conviction" value="yes" required /> Yes, I was convicted</label>
        </div>
        <p class="note seal_conviction_yes" style="display:none;">If you were convicted, arrest record sealing isn't applicable. An expungement would be the right path for a conviction.</p>
        <p class="note seal_conviction_no" style="display:none;">Okay. If there was no conviction, you can likely get the arrest sealed given the case is resolved.</p>
        <p class="error-msg">Please answer this question.</p>
      </div>
      <div id="step-sealing-q2" class="step" style="display:none;">
        <p><strong>Is the arrest case completely resolved with no conviction (charges never filed, dismissed, or you were acquitted)?</strong></p>
        <div class="radio-group">
          <label><input type="radio" name="seal_resolved" value="yes" required /> Yes, the case is over with no conviction</label>
          <label><input type="radio" name="seal_resolved" value="no" required /> No, it's not fully resolved</label>
        </div>
        <p class="note seal_resolved_yes" style="display:none;">Great. Since the case ended without a conviction, you're eligible to petition for sealing that arrest.</p>
        <p class="note seal_resolved_no" style="display:none;">If charges are still pending or not fully resolved, you won't be able to seal the arrest yet.</p>
        <p class="error-msg">Please answer this question.</p>
      </div>
      <!-- Early Probation Termination Questions -->
      <div id="step-termination-q1" class="step" style="display:none;">
        <p><strong>Now let's consider ending your probation early.</strong><br>Have you already served at least half of your probation term?</p>
        <div class="radio-group">
          <label><input type="radio" name="term_half" value="yes" required /> Yes</label>
          <label><input type="radio" name="term_half" value="no" required /> No</label>
        </div>
        <p class="note term_half_yes" style="display:none;">Good. Courts usually expect at least half the probation term to be completed before considering early termination.</p>
        <p class="note term_half_no" style="display:none;">Courts often prefer at least half the term be completed before ending probation early.</p>
        <p class="error-msg">Please answer this question.</p>
      </div>
      <div id="step-termination-q2" class="step" style="display:none;">
        <p><strong>Have you met all other probation requirements (paid fines, completed programs)?</strong></p>
        <div class="radio-group">
          <label><input type="radio" name="term_requirements" value="yes" required /> Yes</label>
          <label><input type="radio" name="term_requirements" value="no" required /> No</label>
        </div>
        <p class="note term_requirements_yes" style="display:none;">Good. Being up-to-date on all requirements will strengthen your request for early termination.</p>
        <p class="note term_requirements_no" style="display:none;">You'll need to complete all court-ordered requirements (or have them waived) before seeking early termination.</p>
        <p class="error-msg">Please answer this question.</p>
      </div>
      <div id="step-termination-q3" class="step" style="display:none;">
        <p><strong>Have you had any probation violations?</strong></p>
        <div class="radio-group">
          <label><input type="radio" name="term_violations" value="no" required /> No, I have a clean record on probation</label>
          <label><input type="radio" name="term_violations" value="yes" required /> Yes, there have been violations</label>
        </div>
        <p class="note term_violations_yes" style="display:none;">Past violations can make it harder (but not impossible) to get probation ended early.</p>
        <p class="note term_violations_no" style="display:none;">Excellent. A clean probation record will help your petition for early termination.</p>
        <p class="error-msg">Please answer this question.</p>
      </div>
      <!-- Disqualifying Offenses Step -->
      <div id="step-disqualify" class="step" style="display:none;">
        <p><strong>Do you have any convictions for offenses that are not eligible for expungement or a Certificate of Rehabilitation?</strong><br><small>(Select any that apply, or leave blank if none)</small></p>
        <label><input type="checkbox" name="disqualify_sex" value="yes" /> Sex offenses requiring registration</label><br>
        <label><input type="checkbox" name="disqualify_violent" value="yes" /> Violent felonies (e.g. murder, armed robbery)</label><br>
        <label><input type="checkbox" name="disqualify_child" value="yes" /> Offenses involving child victims</label><br>
        <label><input type="checkbox" name="disqualify_other" value="yes" /> Other serious disqualifying offenses</label>
        <p class="note disqualify_checked" style="display:none; color: #d9534f;">Unfortunately, such offenses are not eligible for expungement or a Certificate of Rehabilitation.</p>
        <p class="error-msg">Please answer this question.</p>
      </div>
      <!-- Final Summary / Recommendations -->
      <div id="step-summary" class="step" style="display:none;">
        <div id="summary-content"></div>
      </div>
      <!-- Navigation Buttons -->
      <div id="navigation">
        <button type="button" id="prevBtn" class="btn btn-secondary">Back</button>
        <button type="button" id="nextBtn" class="btn btn-primary">Next</button>
      </div>
    </form>
  </div>
  <script>
    (function(){
      const form = document.getElementById('eligibility-form');
      const nameInput = document.getElementById('name');
      const emailQuestionSpan = document.getElementById('userNameSpan');
      const summaryContent = document.getElementById('summary-content');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      // Map step elements by ID for quick access
      const stepElements = {
        'step-name': document.getElementById('step-name'),
        'step-email': document.getElementById('step-email'),
        'step-phone': document.getElementById('step-phone'),
        'step-service': document.getElementById('step-service'),
        'step-exp-q1': document.getElementById('step-exp-q1'),
        'step-exp-q2': document.getElementById('step-exp-q2'),
        'step-exp-q3': document.getElementById('step-exp-q3'),
        'step-exp-q4': document.getElementById('step-exp-q4'),
        'step-exp-q5': document.getElementById('step-exp-q5'),
        'step-exp-q6': document.getElementById('step-exp-q6'),
        'step-cor-q1': document.getElementById('step-cor-q1'),
        'step-cor-q2': document.getElementById('step-cor-q2'),
        'step-cor-q3': document.getElementById('step-cor-q3'),
        'step-sealing-q1': document.getElementById('step-sealing-q1'),
        'step-sealing-q2': document.getElementById('step-sealing-q2'),
        'step-termination-q1': document.getElementById('step-termination-q1'),
        'step-termination-q2': document.getElementById('step-termination-q2'),
        'step-termination-q3': document.getElementById('step-termination-q3'),
        'step-disqualify': document.getElementById('step-disqualify'),
        'step-summary': document.getElementById('step-summary')
      };
      // Initial step sequence (contact info + service)
      let stepSequence = ['step-name','step-email','step-phone','step-service'];
      // Show a specific step by index in the sequence
      function showStep(index) {
        const newId = stepSequence[index];
        const currentId = stepSequence[currentStepIndex];
        // Hide current step
        stepElements[currentId].style.display = 'none';
        // Show new step
        stepElements[newId].style.display = 'block';
        // Adjust Next button text for final step
        if (newId === 'step-summary') {
          nextBtn.style.display = 'none';
        } else {
          nextBtn.style.display = 'inline-block';
          nextBtn.textContent = 'Next';
        }
        currentStepIndex = index;
      }
      // Rebuild step sequence after service selection
      function updateStepSequence() {
        stepSequence = ['step-name','step-email','step-phone','step-service'];
        const selected = Array.from(form.querySelectorAll('input[name="services"]:checked')).map(cb => cb.value);
        const order = ['expungement','cor','sealing','termination'];
        for (let svc of order) {
          if (selected.includes(svc)) {
            switch (svc) {
              case 'expungement':
                stepSequence.push('step-exp-q1','step-exp-q2','step-exp-q3','step-exp-q4','step-exp-q5','step-exp-q6');
                break;
              case 'cor':
                stepSequence.push('step-cor-q1','step-cor-q2','step-cor-q3');
                break;
              case 'sealing':
                stepSequence.push('step-sealing-q1','step-sealing-q2');
                break;
              case 'termination':
                stepSequence.push('step-termination-q1','step-termination-q2','step-termination-q3');
                break;
            }
          }
        }
        if (selected.includes('expungement') || selected.includes('cor')) {
          stepSequence.push('step-disqualify');
        }
        stepSequence.push('step-summary');
      }
      // Get selected service values
      function selectedServiceValues() {
        return Array.from(form.querySelectorAll('input[name="services"]:checked')).map(cb => cb.value);
      }
      // Build final summary content
      function buildSummary() {
        summaryContent.innerHTML = '';
        const nameVal = nameInput.value.trim();
        const firstName = nameVal.split(' ')[0] || nameVal;
        const servicesList = selectedServiceValues();
        // Handle ineligible scenarios
        if (servicesList.includes('expungement') && form.elements['exp_court'] && form.elements['exp_court'].value === 'federal') {
          const heading = document.createElement('h2');
          heading.textContent = 'Eligibility Result';
          const msg = document.createElement('p');
          msg.textContent = (firstName ? 'Thank you, ' + firstName + '. ' : '') +
                            'Unfortunately, federal convictions are not eligible for expungement or a Certificate of Rehabilitation under California law.';
          summaryContent.appendChild(heading);
          summaryContent.appendChild(msg);
          return;
        }
        if ((servicesList.includes('expungement') || servicesList.includes('cor')) &&
            Array.from(form.querySelectorAll('input[name^="disqualify_"]')).some(cb => cb.checked)) {
          const heading = document.createElement('h2');
          heading.textContent = 'Eligibility Result';
          const msg = document.createElement('p');
          msg.textContent = (firstName ? 'Thank you, ' + firstName + '. ' : '') +
                            'Based on your answers, you have offenses that are not eligible for expungement or a Certificate of Rehabilitation. We cannot recommend those services in your case.';
          summaryContent.appendChild(heading);
          summaryContent.appendChild(msg);
          return;
        }
        const heading = document.createElement('h2');
        heading.textContent = 'Recommended Services';
        const intro = document.createElement('p');
        intro.textContent = (firstName ? 'Thank you, ' + firstName + '. ' : '') +
                            'Based on your answers, we recommend the following ' +
                            (servicesList.length > 1 ? 'services' : 'service') + ':';
        summaryContent.appendChild(heading);
        summaryContent.appendChild(intro);
        servicesList.forEach(svc => {
          const block = document.createElement('div');
          block.className = 'recommendation';
          let titleText = '', descriptionText = '', priceText = '', issues = [], suggestion = '';
          // Gather info based on service
          if (svc === 'expungement') {
            titleText = 'Record Expungement';
            priceText = '$990';
            if (form.elements['exp_probation'] && form.elements['exp_probation'].value === 'no') {
              issues.push('you have not completed probation');
              suggestion = 'You may need to finish or terminate probation early before an expungement.';
            }
            if (form.elements['exp_new_offense'] && form.elements['exp_new_offense'].value === 'yes') {
              issues.push('you have pending/new charges');
            }
            if (form.elements['exp_prison'] && form.elements['exp_prison'].value === 'yes') {
              issues.push('the case involved a state prison sentence');
              suggestion = 'A Certificate of Rehabilitation may be a better option for you.';
            }
            descriptionText = 'We prepare and file a petition to dismiss your conviction. A successful expungement clears the conviction from public records, helping you pass background checks.';
          }
          if (svc === 'cor') {
            titleText = 'Certificate of Rehabilitation';
            priceText = '$1,295';
            if (form.elements['cor_completed'] && form.elements['cor_completed'].value === 'no') {
              issues.push('you have not completed all sentences/probation');
            }
            if (form.elements['cor_years'] && form.elements['cor_years'].value === 'no') {
              issues.push('it has not been long since your last offense');
            }
            if (form.elements['cor_resident'] && form.elements['cor_resident'].value === 'no') {
              issues.push('you are not a California resident');
            }
            descriptionText = 'We guide you through obtaining an official court order that recognizes your rehabilitation and automatically submits a pardon application. A Certificate of Rehabilitation can restore rights and improve your opportunities.';
          }
          if (svc === 'sealing') {
            titleText = 'Arrest Record Sealing';
            priceText = '$1,695';
            if (form.elements['seal_conviction'] && form.elements['seal_conviction'].value === 'yes') {
              issues.push('there was a conviction from that arrest');
              suggestion = 'Expungement (not sealing) is the appropriate remedy for a conviction.';
            }
            if (form.elements['seal_resolved'] && form.elements['seal_resolved'].value === 'no') {
              issues.push('the case is not fully resolved yet');
            }
            descriptionText = 'We petition the court to seal and destroy your arrest records. Once sealed, the arrest will not appear on background checks, giving you peace of mind when applying for jobs or housing.';
          }
          if (svc === 'termination') {
            titleText = 'Early Probation Termination';
            priceText = '$1,695';
            if (form.elements['term_half'] && form.elements['term_half'].value === 'no') {
              issues.push('you have not served at least half of your probation');
            }
            if (form.elements['term_requirements'] && form.elements['term_requirements'].value === 'no') {
              issues.push('you have outstanding requirements (fines/programs)');
            }
            if (form.elements['term_violations'] && form.elements['term_violations'].value === 'yes') {
              issues.push('you have past probation violations');
            }
            descriptionText = 'We petition the court to end your probation ahead of schedule. Early termination lifts probation restrictions and allows you to move forward (for example, becoming eligible for expungement sooner).';
          }
          // Create title element
          const titleEl = document.createElement('h3');
          titleEl.textContent = titleText + (priceText ? ' – ' + priceText : '');
          block.appendChild(titleEl);
          // Add issues if any
          if (issues.length > 0) {
            const issuesList = document.createElement('ul');
            issues.forEach(issue => {
              const li = document.createElement('li');
              li.textContent = issue;
              issuesList.appendChild(li);
            });
            block.appendChild(issuesList);
          }
          // Add suggestion note if present
          if (suggestion) {
            const suggestPara = document.createElement('p');
            suggestPara.className = 'eligibility-note warning';
            suggestPara.textContent = suggestion;
            block.appendChild(suggestPara);
          }
          // Add description text
          const descPara = document.createElement('p');
          descPara.textContent = descriptionText;
          block.appendChild(descPara);
          // Add payment link (placeholder)
          const payLink = document.createElement('a');
          payLink.href = "#";
          payLink.className = "btn btn-primary";
          payLink.textContent = "Hire us for " + titleText;
          payLink.onclick = function(e) {
            e.preventDefault();
            alert('Redirecting to secure Stripe payment... (placeholder)');
          };
          block.appendChild(payLink);
          summaryContent.appendChild(block);
        });
        // Closing note
        const closingNote = document.createElement('p');
        closingNote.textContent = 'We will reach out to you soon to discuss the next steps.';
        summaryContent.appendChild(closingNote);
      }
      // Show/hide dynamic notes on selection
      form.querySelectorAll('input[name="exp_court"]').forEach(input => {
        input.addEventListener('change', function() {
          form.querySelector('.exp_court_state').style.display = (this.value === 'state') ? 'block' : 'none';
          form.querySelector('.exp_court_federal').style.display = (this.value === 'federal') ? 'block' : 'none';
        });
      });
      form.querySelectorAll('input[name="exp_probation"]').forEach(input => {
        input.addEventListener('change', function() {
          form.querySelector('.exp_probation_yes').style.display = (this.value === 'yes') ? 'block' : 'none';
          form.querySelector('.exp_probation_no').style.display = (this.value === 'no') ? 'block' : 'none';
        });
      });
      form.querySelectorAll('input[name="exp_restitution_required"]').forEach(input => {
        input.addEventListener('change', function() {
          form.querySelector('.exp_restitution_required_yes').style.display = (this.value === 'yes') ? 'block' : 'none';
          form.querySelector('.exp_restitution_required_no').style.display = (this.value === 'no') ? 'block' : 'none';
        });
      });
      form.querySelectorAll('input[name="exp_restitution_paid"]').forEach(input => {
        input.addEventListener('change', function() {
          form.querySelector('.exp_restitution_paid_yes').style.display = (this.value === 'yes') ? 'block' : 'none';
          form.querySelector('.exp_restitution_paid_no').style.display = (this.value === 'no') ? 'block' : 'none';
          if (this.value === 'no') {
            nextBtn.style.display = 'none';
          } else {
            nextBtn.style.display = 'inline-block';
            nextBtn.textContent = 'Next';
          }
        });
      });
      form.querySelectorAll('input[name="exp_new_offense"]').forEach(input => {
        input.addEventListener('change', function() {
          form.querySelector('.exp_new_offense_yes').style.display = (this.value === 'yes') ? 'block' : 'none';
          form.querySelector('.exp_new_offense_no').style.display = (this.value === 'no') ? 'block' : 'none';
        });
      });
      form.querySelectorAll('input[name="exp_prison"]').forEach(input => {
        input.addEventListener('change', function() {
          form.querySelector('.exp_prison_yes').style.display = (this.value === 'yes') ? 'block' : 'none';
          form.querySelector('.exp_prison_no').style.display = (this.value === 'no') ? 'block' : 'none';
        });
      });
      form.querySelectorAll('input[name="cor_completed"]').forEach(input => {
        input.addEventListener('change', function() {
          form.querySelector('.cor_completed_yes').style.display = (this.value === 'yes') ? 'block' : 'none';
          form.querySelector('.cor_completed_no').style.display = (this.value === 'no') ? 'block' : 'none';
        });
      });
      form.querySelectorAll('input[name="cor_years"]').forEach input => {
        input.addEventListener('change', function() {
          form.querySelector('.cor_years_yes').style.display = (this.value === 'yes') ? 'block' : 'none';
          form.querySelector('.cor_years_no').style.display = (this.value === 'no') ? 'block' : 'none';
        });
      });
      form.querySelectorAll('input[name="cor_resident"]').forEach(input => {
        input.addEventListener('change', function() {
          form.querySelector('.cor_resident_yes').style.display = (this.value === 'yes') ? 'block' : 'none';
          form.querySelector('.cor_resident_no').style.display = (this.value === 'no') ? 'block' : 'none';
        });
      });
      form.querySelectorAll('input[name="seal_conviction"]').forEach input => {
        input.addEventListener('change', function() {
          form.querySelector('.seal_conviction_yes').style.display = (this.value === 'yes') ? 'block' : 'none';
          form.querySelector('.seal_conviction_no').style.display = (this.value === 'no') ? 'block' : 'none';
        });
      });
      form.querySelectorAll('input[name="seal_resolved"]').forEach input => {
        input.addEventListener('change', function() {
          form.querySelector('.seal_resolved_yes').style.display = (this.value === 'yes') ? 'block' : 'none';
          form.querySelector('.seal_resolved_no').style.display = (this.value === 'no') ? 'block' : 'none';
        });
      });
      form.querySelectorAll('input[name="term_half"]').forEach(input => {
        input.addEventListener('change', function() {
          form.querySelector('.term_half_yes').style.display = (this.value === 'yes') ? 'block' : 'none';
          form.querySelector('.term_half_no').style.display = (this.value === 'no') ? 'block' : 'none';
        });
      });
      form.querySelectorAll('input[name="term_requirements"]').forEach(input => {
        input.addEventListener('change', function() {
          form.querySelector('.term_requirements_yes').style.display = (this.value === 'yes') ? 'block' : 'none';
          form.querySelector('.term_requirements_no').style.display = (this.value === 'no') ? 'block' : 'none';
        });
      });
      form.querySelectorAll('input[name="term_violations"]').forEach(input => {
        input.addEventListener('change', function() {
          form.querySelector('.term_violations_yes').style.display = (this.value === 'yes') ? 'block' : 'none';
          form.querySelector('.term_violations_no').style.display = (this.value === 'no') ? 'block' : 'none';
        });
      });
      // Hide error message on input changes
      form.querySelectorAll('input[type="radio"]').forEach(input => {
        input.addEventListener('change', function() {
          const errMsg = this.closest('.step').querySelector('.error-msg');
          if(errMsg) errMsg.style.display = 'none';
        });
      });
      form.querySelectorAll('input[type="checkbox"]').forEach(input => {
        input.addEventListener('change', function() {
          serviceError.style.display = 'none';
        });
      });
      form.querySelectorAll('input[name^="disqualify_"]').forEach(input => {
        input.addEventListener('change', function() {
          const anyChecked = Array.from(form.querySelectorAll('input[name^="disqualify_"]')).some(cb => cb.checked);
          form.querySelector('.disqualify_checked').style.display = anyChecked ? 'block' : 'none';
        });
      });
      const toCorBtn = document.getElementById('toCorBtn');
      if (toCorBtn) {
        toCorBtn.addEventListener('click', function() {
          const expRadio = form.querySelector('#service-expungement');
          form.querySelector('#service-cor').checked = true;
          if (expRadio) expRadio.checked = false;
          updateStepSequence();
          const newIndex = stepSequence.indexOf('step-cor-q1');
          if (newIndex !== -1) {
            showStep(newIndex);
          }
          nextBtn.style.display = 'inline-block';
          nextBtn.textContent = 'Next';
        });
      }
      // Next button click
      nextBtn.addEventListener('click', function() {
        const currentId = stepSequence[currentStepIndex];
        const currentStepEl = stepElements[currentId];
        let stepValid = true;
        const inputs = Array.from(currentStepEl.querySelectorAll('input'));
        if (currentId === 'step-service') {
          const anyChecked = inputs.some(inp => inp.checked);
          if (!anyChecked) {
            serviceError.style.display = 'block';
            stepValid = false;
          }
        } else {
          for (const input of inputs) {
            if (input.type === 'radio') {
              const group = currentStepEl.querySelectorAll('input[name="' + input.name + '"]');
              if (Array.from(group).every(r => !r.checked)) {
                stepValid = false;
              }
            } else if (input.type === 'checkbox') {
              continue;
            } else {
              if (!input.checkValidity()) {
                input.reportValidity();
                stepValid = false;
                break;
              }
            }
          }
          if (!stepValid && currentStepEl.querySelector('.error-msg')) {
            currentStepEl.querySelector('.error-msg').style.display = 'block';
          }
        }
        if (!stepValid) return;
        // If leaving name step, update email step greeting with first name
        if (currentId === 'step-name') {
          const nameVal = nameInput.value.trim();
          const firstName = nameVal.split(' ')[0] || nameVal;
          if (firstName) {
            emailQuestionSpan.textContent = firstName;
          }
        }
        // If leaving service selection, update sequence
        if (currentId === 'step-service') {
          updateStepSequence();
        }
        // Custom routing based on answers
        if (currentId === 'step-exp-q1' && form.elements['exp_court'] && form.elements['exp_court'].value === 'federal') {
          showStep(stepSequence.length - 1);
          return;
        }
        if (currentId === 'step-exp-q2' && form.elements['exp_probation'] && form.elements['exp_probation'].value === 'no') {
          const expRadio = form.querySelector('#service-expungement');
          form.querySelector('#service-termination').checked = true;
          if (expRadio) expRadio.checked = false;
          updateStepSequence();
          showStep(stepSequence.indexOf('step-termination-q1'));
          return;
        }
        if (currentId === 'step-exp-q3' && form.elements['exp_restitution_required'] && form.elements['exp_restitution_required'].value === 'no') {
          showStep(currentStepIndex + 2);
          return;
        }
        if (currentId === 'step-exp-q6' && form.elements['exp_prison'] && form.elements['exp_prison'].value === 'yes') {
          const expRadio = form.querySelector('#service-expungement');
          form.querySelector('#service-cor').checked = true;
          if (expRadio) expRadio.checked = false;
          updateStepSequence();
          showStep(stepSequence.indexOf('step-cor-q1'));
          return;
        }
        // Advance to next step
        const nextIndex = currentStepIndex + 1;
        if (nextIndex < stepSequence.length) {
          showStep(nextIndex);
        }
      });
      // Back button click
      prevBtn.addEventListener('click', function() {
        if (currentStepIndex === 0) return;
        if (stepSequence[currentStepIndex] === 'step-summary') {
          nextBtn.style.display = 'inline-block';
          nextBtn.textContent = 'Next';
        }
        const prevIndex = currentStepIndex - 1;
        showStep(prevIndex);
      });
      // Initialize first step
      let currentStepIndex = 0;
      showStep(0);
    })();
  </script>
</body>
</html>
